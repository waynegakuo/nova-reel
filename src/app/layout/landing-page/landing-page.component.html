<section class="landing-container">
  <div class="header">
    <h1>Welcome to {{ title() }}</h1>
    <p class="subtitle">Discover the best movies and TV shows</p>

    <!-- Search bar -->
    <app-search-bar
      placeholder="Search for movies or TV shows..."
      [debounceTime]="500"
      (search)="onSearch($event)"
      (clear)="clearSearch()"
    ></app-search-bar>

    <!-- Search Results -->
    @if (showSearchResults()) {
      @if (isSearching() && searchResults().length === 0) {
        <div class="search-loading-container">
          <div class="loading-spinner"></div>
          <p>{{ loadingMessagesService.getSearchingMessage() }}</p>
        </div>
      } @else {
        <app-search-results
          [results]="searchResults()"
          [query]="searchQuery()"
          [type]="searchType()"
          [currentPage]="currentSearchPage()"
          [maxPages]="MAX_PAGES"
          (pageChange)="goToSearchPage($event)"
          (resultClick)="navigateToDetails($event.item, $event.type)"
        ></app-search-results>
      }
    }
  </div>

  <app-tab-navigation
    [tabs]="tabsConfig"
    [activeTab]="activeTab()"
    (tabChange)="setActiveTab($event)">
  </app-tab-navigation>

  <div class="content">
    <!-- Dynamic content area that refreshes -->
    <div class="dynamic-content">
      <!-- Loading indicator -->
      @if (isLoading()) {
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>{{ loadingMessagesService.getLoadingMessage() }}</p>
        </div>
      }

      <!-- Error message -->
      @if (error()) {
        <div class="error-container">
          <p>{{ error() }}</p>
          <button class="btn btn-primary" (click)="activeTab() === 'Movies' ? loadMovies('popular') : loadTVShows('popular')">
            Try Again
          </button>
        </div>
      }

      <!-- Movies and TV Shows content -->
      @if ((activeTab() === 'Movies' || activeTab() === 'TV Shows') && !isLoading() && !error()) {
        <app-movies-and-tv-shows
          [activeTab]="activeTab()"
          [movies]="movies()"
          [tvShows]="tvShows()"
          [isLoading]="isLoading()"
          [error]="error()"
          [movieCategories]="movieCategories"
          [tvShowCategories]="tvShowCategories"
          [activeMovieCategory]="activeMovieCategory()"
          [activeTVShowCategory]="activeTVShowCategory()"
          [currentMoviePage]="currentMoviePage()"
          [currentTVShowPage]="currentTVShowPage()"
          [maxPages]="MAX_PAGES"
          (loadMovies)="loadMovies($event)"
          (loadTVShows)="loadTVShows($event)"
          (goToMoviePage)="goToMoviePage($event)"
          (goToTVShowPage)="goToTVShowPage($event)"
          (shareMedia)="onShareMedia($event)">
        </app-movies-and-tv-shows>
      }

      <!-- Favorites content -->
      @if (activeTab() === 'Favorites' && !isLoading() && !error()) {
        <app-favorites
          [favorites]="favorites()"
          [isLoading]="isLoading()"
          [error]="error()"
          (shareMedia)="onShareMedia($event)"
          (refreshFavorites)="loadFavorites()">
        </app-favorites>
      }


      <!-- Smart Recommendations content -->
      @if (activeTab() === 'Smart Recommendations' && !isLoading() && !error()) {
        <app-smart-recommendations
          [smartRecommendations]="smartRecommendations()"
          [smartRecommendationReasoning]="smartRecommendationReasoning()"
          [isLoading]="isLoading()"
          [error]="error()"
          [recommendationHistory]="recommendationHistory()"
          [showHistory]="showHistory()"
          [selectedHistoryEntry]="selectedHistoryEntry()"
          [naturalLanguageQuery]="naturalLanguageQuery()"
          [historyService]="historyService"
          (loadAiRecommendations)="loadAiRecommendations($event)"
          (shareMedia)="onShareMedia($event)"
          (naturalLanguageQueryChange)="naturalLanguageQuery.set($event)"
          (onNaturalLanguageQuery)="onNaturalLanguageQuery($event)"
          (clearNaturalLanguageQuery)="clearNaturalLanguageQuery()"
          (toggleHistoryView)="toggleHistoryView()"
          (loadHistoryEntry)="loadHistoryEntry($event)"
          (clearSelectedHistoryEntry)="clearSelectedHistoryEntry()">
        </app-smart-recommendations>
      }

      <!-- For You content -->
      @if (activeTab() === 'For You' && !isLoading() && !error()) {
        <app-for-you
          [forYouRecommendations]="forYouRecommendations()"
          [forYouRecommendationReasoning]="forYouRecommendationReasoning()"
          [isLoading]="isLoading()"
          [error]="error()"
          (loadAiRecommendations)="loadAiRecommendations($event)"
          (shareMedia)="onShareMedia($event)">
        </app-for-you>
      }

      <!-- Guess the Movie content -->
      @if (activeTab() === 'Guess the Movie' && !isLoading() && !error()) {
        <app-guess-the-movie
          [isLoading]="isLoading()"
          [error]="error()">
        </app-guess-the-movie>
      }
    </div>
  </div>
</section>
